name: Dump Android project for AI review

on:
  push:
    branches: [ "main", "master" ]
  workflow_dispatch:

jobs:
  dump:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Prepare upload directory
        run: |
          rm -rf upload
          mkdir -p upload
          mkdir -p upload/app
          mkdir -p upload/.github/workflows

      - name: Copy root Gradle files
        run: |
          [ -f settings.gradle ] && cp settings.gradle upload/ || true
          [ -f settings.gradle.kts ] && cp settings.gradle.kts upload/ || true
          [ -f build.gradle ] && cp build.gradle upload/ || true
          [ -f build.gradle.kts ] && cp build.gradle.kts upload/ || true
          [ -f gradle.properties ] && cp gradle.properties upload/ || true

      - name: Copy app module sources
        run: |
          if [ -d app ]; then
            mkdir -p upload/app
            cp app/build.gradle upload/app/ 2>/dev/null || true
            cp app/build.gradle.kts upload/app/ 2>/dev/null || true

            if [ -d app/src ]; then
              mkdir -p upload/app/src
              cp -r app/src/main upload/app/src/ 2>/dev/null || true
              cp -r app/src/debug upload/app/src/ 2>/dev/null || true
            fi
          fi

      - name: Copy workflows (for AI context)
        run: |
          if [ -d .github/workflows ]; then
            cp -r .github/workflows upload/.github/
          fi

      - name: Upload for AI
        uses: actions/upload-artifact@v4
        with:
          name: android-project-for-ai
          path: upload
